



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="LeoProject makes LeoFS, which is an open source distributed object storage system and a highly available, distributed, eventually consistent storage system. LeoFS is supporting the following features:Multi-protocol Support - S3-API, REST-API and NFS v3, Large Object Support, Multi Data Center Replication and others.">
      
      
      
        <meta name="author" content="LeoProject">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.3, mkdocs-material-2.7.1">
    
    
      
        <title>Server Side Object Encryption with Customer-Provided Encryption Keys - LeoFS Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.78aab2dc.css">
      
    
    
      <script src="../../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#server-side-object-encryption-with-customer-provided-encryption-keys-sse-c" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="LeoFS Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                LeoFS Documentation
              </span>
              <span class="md-header-nav__topic">
                Server Side Object Encryption with Customer-Provided Encryption Keys
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/leo-project/leofs/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    LeoFS Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/leo-project/leofs/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../whats_new/" title="What's New?" class="md-nav__link">
      What's New?
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../installation/quick/" title="Quick Installation and Setup" class="md-nav__link">
      Quick Installation and Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../installation/cluster/" title="Building a LeoFS' cluster with Ansible" class="md-nav__link">
      Building a LeoFS' cluster with Ansible
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Concept and Architecture
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Concept and Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../architecture/README/" title="LeoFS' Architecture" class="md-nav__link">
      LeoFS' Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../architecture/leo_gateway/" title="LeoGateway's Architecture" class="md-nav__link">
      LeoGateway's Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../architecture/leo_storage/" title="LeoStorage's Architecture" class="md-nav__link">
      LeoStorage's Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../architecture/leo_manager/" title="LeoManager's Architecture" class="md-nav__link">
      LeoManager's Architecture
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      For Administrators
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        For Administrators
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-1" type="checkbox" id="nav-5-1">
    
    <label class="md-nav__link" for="nav-5-1">
      Setup
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-1">
        Setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/setup/planning_for_production/" title="Planning for Production" class="md-nav__link">
      Planning for Production
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/setup/supported_platforms/" title="Supported Platforms" class="md-nav__link">
      Supported Platforms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/setup/hardware_requirements/" title="Hardware Requirements" class="md-nav__link">
      Hardware Requirements
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/setup/network_config/" title="Network Configurations" class="md-nav__link">
      Network Configurations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/system_admin/load_balancing/" title="Load Balancing Configuration" class="md-nav__link">
      Load Balancing Configuration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      Settings
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-2">
        Settings
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/settings/cluster/" title="Cluster Settings" class="md-nav__link">
      Cluster Settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/settings/environment_config/" title="Environment Configuration" class="md-nav__link">
      Environment Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/settings/leo_manager/" title="LeoManager Settings" class="md-nav__link">
      LeoManager Settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/settings/leo_storage/" title="LeoStorage Settings" class="md-nav__link">
      LeoStorage Settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/settings/leo_gateway/" title="LeoGateway Settings" class="md-nav__link">
      LeoGateway Settings
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3">
    
    <label class="md-nav__link" for="nav-5-3">
      Interface
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-3">
        Interface
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/protocols/s3/" title="S3-API" class="md-nav__link">
      S3-API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/protocols/rest/" title="REST-API" class="md-nav__link">
      REST-API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/protocols/nfs_v3/" title="NFS v3" class="md-nav__link">
      NFS v3
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-4" type="checkbox" id="nav-5-4">
    
    <label class="md-nav__link" for="nav-5-4">
      System Operations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-4">
        System Operations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/system_operations/flow/" title="Operation Flow" class="md-nav__link">
      Operation Flow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/system_operations/systemd/" title="Systemd Services" class="md-nav__link">
      Systemd Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/system_operations/s3/" title="S3-API related Operations" class="md-nav__link">
      S3-API related Operations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/system_operations/cluster/" title="Cluster Operations" class="md-nav__link">
      Cluster Operations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/system_operations/data/" title="Data Operations" class="md-nav__link">
      Data Operations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/system_operations/multi_dc_replication/" title="Multi Data Center Replication" class="md-nav__link">
      Multi Data Center Replication
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-5" type="checkbox" id="nav-5-5">
    
    <label class="md-nav__link" for="nav-5-5">
      System Administration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-5">
        System Administration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/system_admin/log_management/" title="Log Management" class="md-nav__link">
      Log Management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/system_admin/persistent_configuration/" title="Persistent Configuration" class="md-nav__link">
      Persistent Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/system_admin/monitoring/" title="System Monitoring" class="md-nav__link">
      System Monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/system_admin/migration/" title="System Migration" class="md-nav__link">
      System Migration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/system_admin/integration/" title="System Integration" class="md-nav__link">
      System Integration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/system_admin/multiple_nodes/" title="Multiple Node Instances" class="md-nav__link">
      Multiple Node Instances
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../admin/index_of_commands/" title="Index of LeoFS' Commands" class="md-nav__link">
      Index of LeoFS' Commands
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../benchmark/README/" title="Benchmark" class="md-nav__link">
      Benchmark
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      FAQ
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        FAQ
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../faq/fundamentals/" title="LeoFS Fundamentals" class="md-nav__link">
      LeoFS Fundamentals
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../faq/limits/" title="LeoFS Limits" class="md-nav__link">
      LeoFS Limits
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../faq/administration/" title="LeoFS Administration" class="md-nav__link">
      LeoFS Administration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../faq/client/" title="LeoFS Clients" class="md-nav__link">
      LeoFS Clients
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../production_checklist/README/" title="Production Checklist" class="md-nav__link">
      Production Checklist
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9" checked>
    
    <label class="md-nav__link" for="nav-9">
      RFCS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        RFCS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-1" type="checkbox" id="nav-9-1" checked>
    
    <label class="md-nav__link" for="nav-9-1">
      Data Protection
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-9-1">
        Data Protection
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Server Side Object Encryption with Customer-Provided Encryption Keys
      </label>
    
    <a href="./" title="Server Side Object Encryption with Customer-Provided Encryption Keys" class="md-nav__link md-nav__link--active">
      Server Side Object Encryption with Customer-Provided Encryption Keys
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" title="Summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#motivation" title="Motivation" class="md-nav__link">
    Motivation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detailed-design" title="Detailed design" class="md-nav__link">
    Detailed design
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requirements" title="Requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-handling-on-leogateway" title="Request Handling on LeoGateway" class="md-nav__link">
    Request Handling on LeoGateway
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encryption-key-information-in-http-header" title="Encryption key information in HTTP Header:" class="md-nav__link">
    Encryption key information in HTTP Header:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy-operation" title="COPY Operation" class="md-nav__link">
    COPY Operation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encryption-and-decryption-of-an-object-on-leostorage" title="Encryption and decryption of an object on LeoStorage" class="md-nav__link">
    Encryption and decryption of an object on LeoStorage
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#drawbacks" title="Drawbacks" class="md-nav__link">
    Drawbacks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rationale-and-alternatives" title="Rationale and Alternatives" class="md-nav__link">
    Rationale and Alternatives
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unresolved-questions" title="Unresolved questions" class="md-nav__link">
    Unresolved questions
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" title="Summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#motivation" title="Motivation" class="md-nav__link">
    Motivation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detailed-design" title="Detailed design" class="md-nav__link">
    Detailed design
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requirements" title="Requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-handling-on-leogateway" title="Request Handling on LeoGateway" class="md-nav__link">
    Request Handling on LeoGateway
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encryption-key-information-in-http-header" title="Encryption key information in HTTP Header:" class="md-nav__link">
    Encryption key information in HTTP Header:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy-operation" title="COPY Operation" class="md-nav__link">
    COPY Operation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encryption-and-decryption-of-an-object-on-leostorage" title="Encryption and decryption of an object on LeoStorage" class="md-nav__link">
    Encryption and decryption of an object on LeoStorage
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#drawbacks" title="Drawbacks" class="md-nav__link">
    Drawbacks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rationale-and-alternatives" title="Rationale and Alternatives" class="md-nav__link">
    Rationale and Alternatives
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unresolved-questions" title="Unresolved questions" class="md-nav__link">
    Unresolved questions
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/leo-project/leofs/edit/master/docs/RFCS/data_protection/ssec.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="server-side-object-encryption-with-customer-provided-encryption-keys-sse-c">Server Side Object Encryption with Customer-Provided Encryption Keys <em>(SSE-C)</em><a class="headerlink" href="#server-side-object-encryption-with-customer-provided-encryption-keys-sse-c" title="Permanent link">&para;</a></h1>
<ul>
<li>Category: Protecting Data in LeoFS</li>
<li>Status: in-progress</li>
<li>Start Date: 2018-04-18</li>
<li>Authors: <a href="https://github.com/yosukehara">Yosuke Hara</a></li>
<li>LeoFS Issue: <a href="https://github.com/leo-project/leofs/issues/114">#114</a></li>
</ul>
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>This RFC suggests implementing server-side object encryption with customer-provided encryption Keys, <em>SSE-C</em> which is one way of protecting data using encryption and conform to AWS S3-API - Protecting Data Using SSE-C <sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup>.</p>
<h2 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">&para;</a></h2>
<p>In order to improve the data protection feature and to provide LeoFS as an enterprise secure data storage, SSE-C must be implemented as one of the data protection functions. After we implement this function, we can provide LeoFS for <a href="https://en.wikipedia.org/wiki/General_Data_Protection_Regulation">GDPR</a>, <a href="https://en.wikipedia.org/wiki/Fast_Healthcare_Interoperability_Resources">FHIR</a> and other data security needs.</p>
<h2 id="detailed-design">Detailed design<a class="headerlink" href="#detailed-design" title="Permanent link">&para;</a></h2>
<h3 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h3>
<p>The data path between LeoFS' clients and LeoGateway is securely protected by HTTPS and the internal communication between LeoGateway and LeoStorage is also protected by Erlang distribution over TLS <sup id="fnref:2"><a class="footnote-ref" href="#fn:2" rel="footnote">2</a></sup>.</p>
<p>LeoFS never store <strong>keys of all customers</strong> and the <strong>original checksum</strong> and <strong>size</strong> of an object on metadata. Since we suggest the requirement that <em>"Anyone who has access to the stored data can try to manipulate the data - even if the data is encrypted. (Quoted from 'Go implementation of the Data At Rest Encryption (DARE) format <sup id="fnref:3"><a class="footnote-ref" href="#fn:3" rel="footnote">3</a></sup>)"</em>, storing the original checksum (MD5) and the size could probably allow attackers to derive the original content by brute force attack based on the size and checksum.</p>
<h3 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h3>
<p>LeoStorage encrypts and decrypts objects because LeoStorage's CPU usage tends to be considerably lower than LeoGateway. Furthermore, in many cases, the number of LeoStorage's in a LeoFS storage system is larger than the number of LeoGateway and thus, load balancing can be expected.</p>
<p>In each of the following operations, LeoStorage handles encryption and decryption of an object after an operation is requested from LeoGateway.</p>
<ul>
<li>GET</li>
<li>Range GET</li>
<li>HEAD</li>
<li>PUT</li>
<li>Multipart Upload</li>
<li>COPY</li>
</ul>
<p>LeoGateway never caches objects to securely protect.</p>
<h3 id="request-handling-on-leogateway">Request Handling on LeoGateway<a class="headerlink" href="#request-handling-on-leogateway" title="Permanent link">&para;</a></h3>
<p>When LeoGateway receives an SSE-C request from a LeoFS' client, it retrieves the encryption key information from the request header, then it sends the information and the object <em>(only if PUT or Multipart Upload operation was requested)</em> to LeoStorage.</p>
<p>When a requested object corresponds to Large Size Object, LeoGateway divides the object to plural chunks of it, then it sends each chunk with the encryption key information to LeoStorage in order to individually execute object encryption.</p>
<h4 id="encryption-key-information-in-http-header">Encryption key information in HTTP Header:<a class="headerlink" href="#encryption-key-information-in-http-header" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code class="codehilite">x-amz-server-side​-encryption​-customer-algorithm</code></td>
<td>Encryption algorithm <em>(AES 256)</em></td>
</tr>
<tr>
<td><code class="codehilite">x-amz-server-side​-encryption​-customer-key</code></td>
<td>256-bit, base64-encoded encryption key</td>
</tr>
<tr>
<td><code class="codehilite">x-amz-server-side​-encryption​-customer-key-MD5</code></td>
<td>Base64-encoded 128-bit MD5 digest of the encryption key</td>
</tr>
</tbody>
</table>
<h4 id="copy-operation">COPY Operation<a class="headerlink" href="#copy-operation" title="Permanent link">&para;</a></h4>
<p>There are four patterns in COPY operation. In SSE-C implementation, LeoFS needs to implement the following cases 1, 2 and 3:</p>
<table>
<thead>
<tr>
<th align="center">No</th>
<th>Source</th>
<th>Destination</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">1</td>
<td>Encrypted</td>
<td>Encrypted</td>
<td>Plans to implement with v2.0</td>
</tr>
<tr>
<td align="center">2</td>
<td>Encrypted</td>
<td>Unencrypted</td>
<td>Plans to implement with v2.0</td>
</tr>
<tr>
<td align="center">3</td>
<td>Unencrypted</td>
<td>Encrypted</td>
<td>Plans to implement with v2.0</td>
</tr>
<tr>
<td align="center">4</td>
<td>Unencrypted</td>
<td>Unencrypted</td>
<td>Ready</td>
</tr>
</tbody>
</table>
<p>If the source object is encrypted using SSE-C <em>(case 1 and 2)</em>, LeoGateway receives encryption key information which includes the following headers so that LeoStorage can decrypt the object for copying.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code class="codehilite">x-amz-copy-source​-server-side​-encryption​-customer-algorithm</code></td>
<td>Encryption algorithm <em>(AES 256)</em></td>
</tr>
<tr>
<td><code class="codehilite">x-amz-copy-source​-server-side​-encryption​-customer-key</code></td>
<td>256-bit, base64-encoded encryption key</td>
</tr>
<tr>
<td><code class="codehilite">x-amz-copy-source-​server-side​-encryption​-customer-key-MD5</code></td>
<td>Base64-encoded 128-bit MD5 digest of the encryption key</td>
</tr>
</tbody>
</table>
<p>Furthermore, when encrypting the destination object <em>(case 1 and 3)</em>, LeoGateway receives encryption key information which is <a href="#encryption-key-information-in-http-header">Encryption key information in HTTP Header</a>.</p>
<h3 id="encryption-and-decryption-of-an-object-on-leostorage">Encryption and decryption of an object on LeoStorage<a class="headerlink" href="#encryption-and-decryption-of-an-object-on-leostorage" title="Permanent link">&para;</a></h3>
<p>LeoStorage receives an object and an encryption key information when LeoGateway requests <strong>WRITE operation</strong>, then it creates an initialization vector <em>(IV)</em> which is commonly called a nonce <em>(number used once)</em>, then it encrypts the object based on <strong>the encryption algorithm</strong> and <strong>the encryption key</strong> and <strong>the initialization vector</strong>, finally it replicates and stores the encrypted object and metadata which includes the following items:</p>
<ul>
<li>256-bit, Key Encryption Key</li>
<li>Initialization Vector <em>(Nonce)</em></li>
</ul>
<p>A needle <em>(LeoObjectStorage Data Format)</em> includes those items which are <strong>stored into the metadata section</strong> in order to be able to transform metadata to each other for durability. See <a href="https://leo-project.net/leofs/docs/architecture/leo_storage/#data-structure">LeoFS Documentation / Architecture / LeoStorage - Data Structure</a>.</p>
<p>LeoStorage receives an encryption key information when LeoGateway requests <strong>READ operation</strong>, then it looks up the metadata which includes the encryption information and the object, then the object is decrypted based on <strong>the encryption algorithm</strong>, <strong>the encryption key</strong>, and <strong>the initialization vector</strong>, finally, it returns the decrypted object to LeoGateway.</p>
<p>Even when Range GET operation is requested, LeoStorage handles the same as GET operation and retrieves the range of the object after object decryption.</p>
<h2 id="drawbacks">Drawbacks<a class="headerlink" href="#drawbacks" title="Permanent link">&para;</a></h2>
<ul>
<li>Compared with an unencrypted object, LeoFS certainly degrade the read performance when retrieving an encrypted object <em>(secure data)</em> because LeoGateway never caches the objects to securely protect.</li>
</ul>
<h2 id="rationale-and-alternatives">Rationale and Alternatives<a class="headerlink" href="#rationale-and-alternatives" title="Permanent link">&para;</a></h2>
<p>Initially, we were considering <strong>implementing object encryption and decryption on LeoGateway</strong>. However, we realized that there are the following problems, we decided to implement that on LeoStorage.</p>
<ul>
<li>LeoGateway's CPU usage tends to be high. We must not assign more processing, object encryption and decryption to LeoGateway.</li>
<li>In many cases, the number of LeoGateway is smaller than the number of LeoStorage. Load balancing cannot be expected.</li>
<li>In order to prevent vulnerabilities, secure data must not be cached.</li>
<li>When handling Range GET operation, LeoGateway retrieves an object in the specified range from LeoStorage, then decrypt it, finally returns it to a client. In this way, the data traffic is higher than retrieving unencrypted objects.</li>
</ul>
<h2 id="unresolved-questions">Unresolved questions<a class="headerlink" href="#unresolved-questions" title="Permanent link">&para;</a></h2>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p><a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html" target="_blank">Amazon S3 / Protecting Data Using Server-Side Encryption with Customer-Provided Encryption Keys (SSE-C)</a>&#160;<a class="footnote-backref" href="#fnref:1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p><a href="https://www.erlang-solutions.com/blog/erlang-distribution-over-tls.html" target="_blank">Erlang distribution over TLS</a>&#160;<a class="footnote-backref" href="#fnref:2" rev="footnote" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p><a href="https://github.com/minio/sio" target="_blank">Secure IO / Go implementation of the Data At Rest Encryption (DARE) format</a>&#160;<a class="footnote-backref" href="#fnref:3" rev="footnote" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../../production_checklist/README/" title="Production Checklist" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Production Checklist
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            (c) 2012-2018 LeoProject. All rights reserved.
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.8eb9be28.js"></script>
      
      <script>app.initialize({version:"0.17.3",url:{base:"../../.."}})</script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-5301881-3","leo-project.net"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>