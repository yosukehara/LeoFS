



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="LeoProject makes LeoFS, which is an open source distributed object storage system and a highly available, distributed, eventually consistent storage system. LeoFS is supporting the following features:Multi-protocol Support - S3-API, REST-API and NFS v3, Large Object Support, Multi Data Center Replication and others.">
      
      
      
        <meta name="author" content="LeoProject">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.3, mkdocs-material-2.7.1">
    
    
      
        <title>Data Operations - LeoFS Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.78aab2dc.css">
      
    
    
      <script src="../../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#data-operations" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="LeoFS Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                LeoFS Documentation
              </span>
              <span class="md-header-nav__topic">
                Data Operations
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/leo-project/leofs/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    LeoFS Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/leo-project/leofs/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../whats_new/" title="What's New?" class="md-nav__link">
      What's New?
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../installation/quick/" title="Quick Installation and Setup" class="md-nav__link">
      Quick Installation and Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../installation/cluster/" title="Building a LeoFS' cluster with Ansible" class="md-nav__link">
      Building a LeoFS' cluster with Ansible
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Concept and Architecture
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Concept and Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../architecture/README/" title="LeoFS' Architecture" class="md-nav__link">
      LeoFS' Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../architecture/leo_gateway/" title="LeoGateway's Architecture" class="md-nav__link">
      LeoGateway's Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../architecture/leo_storage/" title="LeoStorage's Architecture" class="md-nav__link">
      LeoStorage's Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../architecture/leo_manager/" title="LeoManager's Architecture" class="md-nav__link">
      LeoManager's Architecture
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      For Administrators
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        For Administrators
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-1" type="checkbox" id="nav-5-1">
    
    <label class="md-nav__link" for="nav-5-1">
      Setup
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-1">
        Setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/planning_for_production/" title="Planning for Production" class="md-nav__link">
      Planning for Production
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/supported_platforms/" title="Supported Platforms" class="md-nav__link">
      Supported Platforms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/hardware_requirements/" title="Hardware Requirements" class="md-nav__link">
      Hardware Requirements
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../setup/network_config/" title="Network Configurations" class="md-nav__link">
      Network Configurations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../system_admin/load_balancing/" title="Load Balancing Configuration" class="md-nav__link">
      Load Balancing Configuration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      Settings
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-2">
        Settings
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../settings/cluster/" title="Cluster Settings" class="md-nav__link">
      Cluster Settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../settings/environment_config/" title="Environment Configuration" class="md-nav__link">
      Environment Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../settings/leo_manager/" title="LeoManager Settings" class="md-nav__link">
      LeoManager Settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../settings/leo_storage/" title="LeoStorage Settings" class="md-nav__link">
      LeoStorage Settings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../settings/leo_gateway/" title="LeoGateway Settings" class="md-nav__link">
      LeoGateway Settings
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3">
    
    <label class="md-nav__link" for="nav-5-3">
      Interface
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-3">
        Interface
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../protocols/s3/" title="S3-API" class="md-nav__link">
      S3-API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../protocols/rest/" title="REST-API" class="md-nav__link">
      REST-API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../protocols/nfs_v3/" title="NFS v3" class="md-nav__link">
      NFS v3
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-4" type="checkbox" id="nav-5-4" checked>
    
    <label class="md-nav__link" for="nav-5-4">
      System Operations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-4">
        System Operations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../flow/" title="Operation Flow" class="md-nav__link">
      Operation Flow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../systemd/" title="Systemd Services" class="md-nav__link">
      Systemd Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../s3/" title="S3-API related Operations" class="md-nav__link">
      S3-API related Operations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cluster/" title="Cluster Operations" class="md-nav__link">
      Cluster Operations
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Data Operations
      </label>
    
    <a href="./" title="Data Operations" class="md-nav__link md-nav__link--active">
      Data Operations
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#storage-architecture" title="Storage Architecture" class="md-nav__link">
    Storage Architecture
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#append-only-for-content" title="Append-Only for Content" class="md-nav__link">
    Append-Only for Content
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#embedded-kvs-for-metadata" title="Embedded KVS for Metadata" class="md-nav__link">
    Embedded KVS for Metadata
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-queue-for-async-operations" title="Message Queue for Async Operations" class="md-nav__link">
    Message Queue for Async Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-structure" title="File Structure" class="md-nav__link">
    File Structure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-compaction" title="Data Compaction" class="md-nav__link">
    Data Compaction
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-operate-data-compaction" title="How To Operate Data Compaction" class="md-nav__link">
    How To Operate Data Compaction
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state-transition" title="State Transition" class="md-nav__link">
    State Transition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#commands" title="Commands" class="md-nav__link">
    Commands
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compact-start" title="compact-start" class="md-nav__link">
    compact-start
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compact-suspend" title="compact-suspend" class="md-nav__link">
    compact-suspend
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compact-resume" title="compact-resume" class="md-nav__link">
    compact-resume
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compact-status" title="compact-status" class="md-nav__link">
    compact-status
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagnose-start" title="diagnose-start" class="md-nav__link">
    diagnose-start
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#du" title="du" class="md-nav__link">
    du
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#du-detail" title="du detail" class="md-nav__link">
    du detail
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagnosis" title="Diagnosis" class="md-nav__link">
    Diagnosis
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recover-objects" title="Recover Objects" class="md-nav__link">
    Recover Objects
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#commands_1" title="Commands" class="md-nav__link">
    Commands
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recover-file" title="recover-file" class="md-nav__link">
    recover-file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recover-disk" title="recover-disk" class="md-nav__link">
    recover-disk
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recover-node" title="recover-node" class="md-nav__link">
    recover-node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recover-cluster" title="recover-cluster" class="md-nav__link">
    recover-cluster
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases" title="Use Cases" class="md-nav__link">
    Use Cases
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-links" title="Related Links" class="md-nav__link">
    Related Links
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../multi_dc_replication/" title="Multi Data Center Replication" class="md-nav__link">
      Multi Data Center Replication
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-5" type="checkbox" id="nav-5-5">
    
    <label class="md-nav__link" for="nav-5-5">
      System Administration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-5">
        System Administration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../system_admin/log_management/" title="Log Management" class="md-nav__link">
      Log Management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../system_admin/persistent_configuration/" title="Persistent Configuration" class="md-nav__link">
      Persistent Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../system_admin/monitoring/" title="System Monitoring" class="md-nav__link">
      System Monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../system_admin/migration/" title="System Migration" class="md-nav__link">
      System Migration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../system_admin/integration/" title="System Integration" class="md-nav__link">
      System Integration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../system_admin/multiple_nodes/" title="Multiple Node Instances" class="md-nav__link">
      Multiple Node Instances
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index_of_commands/" title="Index of LeoFS' Commands" class="md-nav__link">
      Index of LeoFS' Commands
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../benchmark/README/" title="Benchmark" class="md-nav__link">
      Benchmark
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      FAQ
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        FAQ
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../faq/fundamentals/" title="LeoFS Fundamentals" class="md-nav__link">
      LeoFS Fundamentals
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../faq/limits/" title="LeoFS Limits" class="md-nav__link">
      LeoFS Limits
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../faq/administration/" title="LeoFS Administration" class="md-nav__link">
      LeoFS Administration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../faq/client/" title="LeoFS Clients" class="md-nav__link">
      LeoFS Clients
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../production_checklist/README/" title="Production Checklist" class="md-nav__link">
      Production Checklist
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      RFCS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        RFCS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-1" type="checkbox" id="nav-9-1">
    
    <label class="md-nav__link" for="nav-9-1">
      Data Protection
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-9-1">
        Data Protection
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../RFCS/data_protection/ssec/" title="Server Side Object Encryption with Customer-Provided Encryption Keys" class="md-nav__link">
      Server Side Object Encryption with Customer-Provided Encryption Keys
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#storage-architecture" title="Storage Architecture" class="md-nav__link">
    Storage Architecture
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#append-only-for-content" title="Append-Only for Content" class="md-nav__link">
    Append-Only for Content
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#embedded-kvs-for-metadata" title="Embedded KVS for Metadata" class="md-nav__link">
    Embedded KVS for Metadata
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-queue-for-async-operations" title="Message Queue for Async Operations" class="md-nav__link">
    Message Queue for Async Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-structure" title="File Structure" class="md-nav__link">
    File Structure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-compaction" title="Data Compaction" class="md-nav__link">
    Data Compaction
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-operate-data-compaction" title="How To Operate Data Compaction" class="md-nav__link">
    How To Operate Data Compaction
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state-transition" title="State Transition" class="md-nav__link">
    State Transition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#commands" title="Commands" class="md-nav__link">
    Commands
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compact-start" title="compact-start" class="md-nav__link">
    compact-start
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compact-suspend" title="compact-suspend" class="md-nav__link">
    compact-suspend
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compact-resume" title="compact-resume" class="md-nav__link">
    compact-resume
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compact-status" title="compact-status" class="md-nav__link">
    compact-status
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagnose-start" title="diagnose-start" class="md-nav__link">
    diagnose-start
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#du" title="du" class="md-nav__link">
    du
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#du-detail" title="du detail" class="md-nav__link">
    du detail
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagnosis" title="Diagnosis" class="md-nav__link">
    Diagnosis
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recover-objects" title="Recover Objects" class="md-nav__link">
    Recover Objects
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#commands_1" title="Commands" class="md-nav__link">
    Commands
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recover-file" title="recover-file" class="md-nav__link">
    recover-file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recover-disk" title="recover-disk" class="md-nav__link">
    recover-disk
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recover-node" title="recover-node" class="md-nav__link">
    recover-node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recover-cluster" title="recover-cluster" class="md-nav__link">
    recover-cluster
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases" title="Use Cases" class="md-nav__link">
    Use Cases
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-links" title="Related Links" class="md-nav__link">
    Related Links
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/leo-project/leofs/edit/master/docs/admin/system_operations/data.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="data-operations">Data Operations<a class="headerlink" href="#data-operations" title="Permanent link">&para;</a></h1>
<p>This section provides information to operate data stored in LeoFS as well as the prior knowledge that gives you the better understanding about what will happen behind the scene when you invoke a command for a data operation.</p>
<h2 id="storage-architecture">Storage Architecture<a class="headerlink" href="#storage-architecture" title="Permanent link">&para;</a></h2>
<p>A brief introduction how LeoFS organize data into actual OS files.</p>
<h3 id="append-only-for-content">Append-Only for Content<a class="headerlink" href="#append-only-for-content" title="Permanent link">&para;</a></h3>
<p>Once a PUT/DELETE remote procedure call, <strong>RPC</strong> arrives on LeoStorage appends new blocks including the object information such as the key, data itself and also various associated metadata to the end of a file.</p>
<p>This <em>Append-Only-File</em> we call <a href="../../../architecture/leo_storage/#data-structure">AVS, Aria Vector Storage</a> which is referenced when retrieving the data through <em>GET RPCs</em>. With its inherent nature of the <em>Append-Only-File</em>, a data-compaction process is needed to clean up the orphaned space in an AVS.</p>
<h3 id="embedded-kvs-for-metadata">Embedded KVS for Metadata<a class="headerlink" href="#embedded-kvs-for-metadata" title="Permanent link">&para;</a></h3>
<p>After having succeeded in appending new blocks to an AVS, then leo_object_storage updates a corresponding <strong>KVS</strong> file with the key and its associated metadata <em>(same information stored in the AVS except for the data itself)</em> and its offset where the new blocks stored in AVS as a value. This KVS file is referenced when retrieving the data/metadata through GET/HEAD RPCs.</p>
<h3 id="message-queue-for-async-operations">Message Queue for Async Operations<a class="headerlink" href="#message-queue-for-async-operations" title="Permanent link">&para;</a></h3>
<p>Some data can be stored into a <strong>Queue</strong> for processing later in the case</p>
<ul>
<li>A PUT/DELETE operation failed</li>
<li>A Multi DC Replication, <strong>MDCR</strong> failed</li>
<li><code class="codehilite">rebalance/recover-(file|node|cluster)</code> invoked through leofs-adm</li>
</ul>
<h3 id="file-structure">File Structure<a class="headerlink" href="#file-structure" title="Permanent link">&para;</a></h3>
<p>Multiple AVS/KVS pairs can be placed on one node to enable LeoFS handling as much use cases and hardware requirements as possible. See <a href="../../../architecture/leo_storage/#data-structure">Concept and Architecture / LeoStorage's Architecture - Data Structure</a>.</p>
<ul>
<li><strong>Container : AVS/KVS pair = 1 : N</strong><ul>
<li>Multiple AVS/KVS pairs can be stored under one OS directory. It is called <strong>Container</strong>.</li>
<li>'N' can be specified through <a href="https://github.com/leo-project/leofs/blob/master/apps/leo_storage/priv/leo_storage.conf">leo_storage.conf</a>.</li>
<li>How to choose optimal 'N'<ul>
<li>As a data-compaction is executed per AVS/KVS pair, at least the size of a AVS/KVS pair is needed to run data-compaction so that the larger 'N', the less disk space LeoFS uses for data-compaction.</li>
<li>However the larger N, the more disk seeks LeoFS suffers.</li>
<li>Tha said, the optimal N is determined by setting the largest value that doesn't affect the online throughput you would expect.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Node : Container = 1 : N</strong><ul>
<li>Each Container can be stored under a different OS directory.</li>
<li>N can be specified through leo_storage.conf.</li>
<li>Setting <code class="codehilite">N &gt; 1</code> can be useful when there are multiple JBOD disks on the node. The one JBOD disk array can be map to the one container.</li>
</ul>
</li>
</ul>
<h3 id="data-compaction">Data Compaction<a class="headerlink" href="#data-compaction" title="Permanent link">&para;</a></h3>
<p>This section provides information about what/how data-compaction can affect the online performance.</p>
<ul>
<li>Parallelism<ul>
<li>A data-compaction can be executed across multiple AVS/KVS pairs in parallel.</li>
<li>The number of data-compaction processes can be specified through an argument of leofs-adm.</li>
<li>Increasing the number can be useful when the load coming from online is relatively low and want a data-compaction process to boost as much as possible.</li>
<li>Be careful that too much number can make a data-compaction process slow down.</li>
</ul>
</li>
<li>Concurrent with any operation coming from online.<ul>
<li>GET/HEAD never be blocked by a data-compaction.</li>
<li>PUT/DELETE can be blocked while a data-compaction is processing the tail part of an AVS.</li>
<li>Given that the above limitation, We would recommend suspending a node you are supposed to run a data-compaction if a LeoFS system's cluster handles write intensive workload.</li>
</ul>
</li>
</ul>
<h2 id="how-to-operate-data-compaction">How To Operate Data Compaction<a class="headerlink" href="#how-to-operate-data-compaction" title="Permanent link">&para;</a></h2>
<p>As described in the previous section, A compaction process is needed to remove logically deleted objects and its corresponding metadata.</p>
<h3 id="state-transition">State Transition<a class="headerlink" href="#state-transition" title="Permanent link">&para;</a></h3>
<p><img alt="State Transition" src="../../../assets/leofs-compaction-state-transition.png" /></p>
<h3 id="commands">Commands<a class="headerlink" href="#commands" title="Permanent link">&para;</a></h3>
<p>Commands related to Compaction as well as Disk Usage.</p>
<table>
<thead>
<tr>
<th>Shell</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Compaction Commands</strong></td>
<td></td>
</tr>
<tr>
<td><code class="codehilite">leofs-adm compact-start &lt;storage-node&gt; (all/&lt;num-of-targets&gt;) [&lt;num-of-compaction-proc&gt;]</code></td>
<td>Start Compaction <em>(Transfer its state to <strong>running</strong>)</em>.<br/><br/><code class="codehilite">num-of-targets</code>: How many AVS/KVS pairs are compacted.<br/><code class="codehilite">num-of-compaction-pro</code>: How many processes are run in parallel.</td>
</tr>
<tr>
<td><code class="codehilite">leofs-adm compact-suspend &lt;storage-node&gt;</code></td>
<td>Suspend Compaction <em>(Transfer its state to 'suspend' from running)</em>.</td>
</tr>
<tr>
<td><code class="codehilite">leofs-adm compact-resume &lt;storage-node&gt;</code></td>
<td>Resume Compaction <em>(Transfer its state to 'running' from suspend)</em>.</td>
</tr>
<tr>
<td><code class="codehilite">leofs-adm compact-status &lt;storage-node&gt;</code></td>
<td>See the Current Compaction Status.</td>
</tr>
<tr>
<td><code class="codehilite">leofs-adm diagnose-start &lt;storage-node&gt;</code></td>
<td>Start Diagnose <em>(Not actually doing Compaction but scanning all AVS/KVS pairs and reporting what objects/metadatas exist as a file)</em>.</td>
</tr>
<tr>
<td><strong>Disk Usage</strong></td>
<td></td>
</tr>
<tr>
<td><code class="codehilite">leofs-adm du &lt;storage-node&gt;</code></td>
<td>See the Current Disk Usage.</td>
</tr>
<tr>
<td><code class="codehilite">leofs-adm du detail &lt;storage-node&gt;</code></td>
<td>See the Current Disk Usage in detail.</td>
</tr>
</tbody>
</table>
<h4 id="compact-start">compact-start<a class="headerlink" href="#compact-start" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">## Note:</span>
<span class="c1">##   All AVS/KVS pairs on storage_0@127.0.0.1</span>
<span class="c1">##   will be compacted with 3 concurrent processes (default concurrency is 3)</span>
<span class="c1">## Example:</span>
$ leofs-adm compact-start storage_0@127.0.0.1 all
OK

<span class="c1">## Note:</span>
<span class="c1">##   Five AVS/KVS pairs on storage_0@127.0.0.1</span>
<span class="c1">##   will be compacted with 2 concurrent processes</span>
$ leofs-adm compact-start storage_0@127.0.0.1 <span class="m">5</span> <span class="m">2</span>
OK
</pre></div>
</td></tr></table>

<h4 id="compact-suspend">compact-suspend<a class="headerlink" href="#compact-suspend" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">## Example:</span>
$ leofs-adm compact-suspend storage_0@127.0.0.1
OK
</pre></div>
</td></tr></table>

<h4 id="compact-resume">compact-resume<a class="headerlink" href="#compact-resume" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">## Example:</span>
$ leofs-adm compact-resume storage_0@127.0.0.1
OK
</pre></div>
</td></tr></table>

<h4 id="compact-status">compact-status<a class="headerlink" href="#compact-status" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">## Example:</span>
$ leofs-adm compact-status storage_0@127.0.0.1
        current status: running
 last compaction start: <span class="m">2013</span>-03-04 <span class="m">12</span>:39:47 +0900
         total targets: <span class="m">64</span>
  <span class="c1"># of pending targets: 5</span>
  <span class="c1"># of ongoing targets: 3</span>
  <span class="c1"># of out of targets : 56</span>
</pre></div>
</td></tr></table>

<h4 id="diagnose-start">diagnose-start<a class="headerlink" href="#diagnose-start" title="Permanent link">&para;</a></h4>
<p>See also <strong>diagnosis-log format</strong> to understand the output log format.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">## Example:</span>
$ leofs-adm diagnose-start storage_0@127.0.0.1
OK
</pre></div>
</td></tr></table>

<h4 id="du">du<a class="headerlink" href="#du" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">## Example:</span>
$ leofs-adm du storage_0@127.0.0.1
 active number of objects: <span class="m">19968</span>
  total number of objects: <span class="m">39936</span>
   active size of objects: <span class="m">198256974</span>.0
    total size of objects: <span class="m">254725020</span>.0
     ratio of active size: <span class="m">77</span>.83%
    last compaction start: <span class="m">2013</span>-03-04 <span class="m">12</span>:39:47 +0900
      last compaction end: <span class="m">2013</span>-03-04 <span class="m">12</span>:39:55 +0900
</pre></div>
</td></tr></table>

<h4 id="du-detail">du detail<a class="headerlink" href="#du-detail" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">## Example:</span>
$ leofs-adm du detail storage_0@127.0.0.1
<span class="o">[</span>du<span class="o">(</span>storage stats<span class="o">)]</span>
                file path: /home/leofs/dev/leofs/package/leofs/storage/avs/object/0.avs
 active number of objects: <span class="m">320</span>
  total number of objects: <span class="m">640</span>
   active size of objects: <span class="m">3206378</span>.0
    total size of objects: <span class="m">4082036</span>.0
     ratio of active size: <span class="m">78</span>.55%
    last compaction start: <span class="m">2013</span>-03-04 <span class="m">12</span>:39:47 +0900
      last compaction end: <span class="m">2013</span>-03-04 <span class="m">12</span>:39:55 +0900
.
.
.
                file path: /home/leofs/dev/leofs/package/leofs/storage/avs/object/63.avs
 active number of objects: <span class="m">293</span>
  total number of objects: <span class="m">586</span>
   active size of objects: <span class="m">2968909</span>.0
    total size of objects: <span class="m">3737690</span>.0
     ratio of active size: <span class="m">79</span>.43%
    last compaction start: ____-__-__ __:__:__
      last compaction end: ____-__-__ __:__:__
</pre></div>
</td></tr></table>

<h3 id="diagnosis">Diagnosis<a class="headerlink" href="#diagnosis" title="Permanent link">&para;</a></h3>
<p>This section explains the file format generated by <code class="codehilite">leofs-adm diagnose-start</code> in detail.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>## Example:
------+------------------------------------------+------------------------------------------------------------+-----------+------------+------------------+--------------------------+----
Offset| RING&#39;s address-id                        | Filename                                                   | Child num | File Size  | Unixtime         | Localtime                |del?
------+------------------------------------------+------------------------------------------------------------+-----------+------------+------------------+--------------------------+----
194     296754181484029444656944009564610621293   photo/leo_redundant_manager/Makefile                             0       2034        1413348050768344   2014-10-15 13:40:50 +0900   0
2400    185993533055981727582172380494809056426   photo/leo_redundant_manager/ebin/leo_redundant_manager.beam      0       24396       1413348050869454   2014-10-15 13:40:50 +0900   0
38446   53208912738248114804281793572563205919    photo/leo_rpc/.git/refs/remotes/origin/HEAD                      0       33          1413348057441546   2014-10-15 13:40:57 +0900   0
38658   57520977797167422772945547576980778561    photo/leo_rpc/ebin/leo_rpc_client_utils.beam                     0       2576        1413348057512261   2014-10-15 13:40:57 +0900   0
69506   187294034498591995039607573685274229706   photo/leo_backend_db/src/leo_backend_db_server.erl               0       13911       1413348068031188   2014-10-15 13:41:08 +0900   0
83603   316467020376888598364250682951088839795   photo/leo_backend_db/test/leo_backend_db_api_prop.erl            0       3507        1413348068052219   2014-10-15 13:41:08 +0900   1
</pre></div>
</td></tr></table>

<p>The file is formatted as Tab Separated Values <em>(TSV)</em> except headers <em>(head three lines of a file)</em>. The detail of each column are described below:</p>
<table>
<thead>
<tr>
<th>Column Number</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>byte-wise Offset where the object is located in an AVS.</td>
</tr>
<tr>
<td>2</td>
<td>Address ID on RING <em>(Distribute Hash Routing Table)</em>.</td>
</tr>
<tr>
<td>3</td>
<td>File Name.</td>
</tr>
<tr>
<td>4</td>
<td>The Number of Children in a File.</td>
</tr>
<tr>
<td>5</td>
<td>File Size in bytes.</td>
</tr>
<tr>
<td>6</td>
<td>Timestamp in Unix Time.</td>
</tr>
<tr>
<td>7</td>
<td>Timestamp in Local Time.</td>
</tr>
<tr>
<td>8</td>
<td>Flag <em>(0/1)</em> representing whether the object is removed.</td>
</tr>
</tbody>
</table>
<h2 id="recover-objects">Recover Objects<a class="headerlink" href="#recover-objects" title="Permanent link">&para;</a></h2>
<p>This section provides information about the recovery commands that can be used in order to recover inconsistencies in a LeoFS cluster according to failures.</p>
<h3 id="commands_1">Commands<a class="headerlink" href="#commands_1" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Shell</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code class="codehilite">leofs-adm recover-file &lt;file-path&gt;</code></td>
<td>Recover the inconsistent object specified by the file-path.</td>
</tr>
<tr>
<td><code class="codehilite">leofs-adm recover-disk &lt;storage-node&gt; &lt;disk-id&gt;</code></td>
<td>Recover all inconsistent objects on the specified disk in the specified storage-node. <strong>Note that this command can be used ONLY in case all LeoStorage have the same obj_containers configuration.</strong></td>
</tr>
<tr>
<td><code class="codehilite">leofs-adm recover-ring &lt;storage-node&gt;</code></td>
<td>Recover <strong>RING, a routing table</strong> of the specified node of the local cluster</td>
</tr>
<tr>
<td><code class="codehilite">leofs-adm recover-node &lt;storage-node&gt;</code></td>
<td>Recover all inconsistent objects in the specified storage-node.</td>
</tr>
<tr>
<td><code class="codehilite">leofs-adm recover-cluster &lt;remote-cluster-id&gt;</code></td>
<td>Recover <strong>all inconsistent objects in the specified remote cluster</strong> <em>(NOT the local cluster)</em> in case of using <strong>the multi datacenter replication</strong>.</td>
</tr>
</tbody>
</table>
<h4 id="recover-file">recover-file<a class="headerlink" href="#recover-file" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">## Example:</span>
$ leofs-adm recover-file leo/fast/storage.key
OK
</pre></div>
</td></tr></table>

<h4 id="recover-disk">recover-disk<a class="headerlink" href="#recover-disk" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">## Note:</span>
<span class="c1">##   If you have the following configuration in leo_storage.conf</span>
<span class="c1">##   obj_containers.path = [./avs1,./avs2]</span>
<span class="c1">##   then the below command will recover files stored under ./avs1</span>
<span class="c1">## Example:</span>
$ leofs-adm recover-disk storage_0@127.0.0.1 <span class="m">1</span>
OK

<span class="c1">## Note:</span>
<span class="c1">##  If you want to recover files stored under ./avs2</span>
<span class="c1">##  then issue the below one.</span>
<span class="c1">## Example:</span>
$ leofs-adm recover-disk storage_0@127.0.0.1 <span class="m">2</span>
OK
</pre></div>
</td></tr></table>

<h4 id="recover-node">recover-node<a class="headerlink" href="#recover-node" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">## Example:</span>
$ leofs-adm recover-node storage_0@127.0.0.1
OK
</pre></div>
</td></tr></table>

<h4 id="recover-cluster">recover-cluster<a class="headerlink" href="#recover-cluster" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">## Note:</span>
<span class="c1">##   If your LeoFS already uses the multi data center replication,</span>
<span class="c1">##   you can execute this command.</span>
<span class="c1">## Example:</span>
$ leofs-adm recover-cluster remote-leofs
OK
</pre></div>
</td></tr></table>

<h3 id="use-cases">Use Cases<a class="headerlink" href="#use-cases" title="Permanent link">&para;</a></h3>
<p>When/How to use recover commands.</p>
<ul>
<li>AVS/KVS Broken<ul>
<li>Invoke <code class="codehilite">recover-node</code> with a node having broken AVS/KVS files or <code class="codehilite">recover-disk</code> with a disk having broken AVS/KVS files if you have multiple container directories.</li>
</ul>
</li>
<li>Queue Broken<ul>
<li>Invoke <code class="codehilite">recover-node</code> with every node except which having broken Queue files.</li>
<li>The procedure might be improved in future when <a href="https://github.com/leo-project/leofs/issues/618">issue#618</a> solved.</li>
</ul>
</li>
<li>Disk Broken<ul>
<li>Invoke <code class="codehilite">suspend</code> with a node having broken Disk arrays and subsequently run <code class="codehilite">leo_storage stop</code>.</li>
<li>Exchange broken Disk arrays.</li>
<li>Run <code class="codehilite">leo_storage start</code> and subsequently Invoke <code class="codehilite">resume</code> with the node.</li>
<li>Invoke <code class="codehilite">recover-node</code> with the node or <code class="codehilite">recover-disk</code> with the broken disk if you have multiple container directories.</li>
</ul>
</li>
<li>Node Broken<ul>
<li>Invoke <code class="codehilite">detach</code> with a broken node.</li>
<li>Prepare a new node that will take over all objects assigned to a detached node.</li>
<li>Invoke <code class="codehilite">rebalance</code>.</li>
</ul>
</li>
<li>Source/Destination Cluster Down<ul>
<li>Invoke <code class="codehilite">recover-cluster</code> with a downed cluster.</li>
</ul>
</li>
<li>Source/Destination Cluster Down and delete operations on the other side got lost <em>(compacted)</em>.<ul>
<li>Set up the cluster from scratch</li>
<li>invoke <code class="codehilite">recover-cluster</code> with the new cluster</li>
<li>See also <a href="https://github.com/leo-project/leofs/issues/636">issue#636</a> for more information.</li>
</ul>
</li>
<li>Regular Scrub<ul>
<li>In order to keep data consistent on the eventual consistent system, The regular scrub should be done.</li>
<li>So we'd recommend users run <code class="codehilite">recover-node</code> regularly while keeping the below cautions in mind,<ul>
<li>Run <code class="codehilite">recover-node</code> one-by-one at the off-peak time of your system</li>
<li>When some LeoStorage go down during the recover process, just do it over again once the downed nodes come back</li>
<li>Generally speaking, it depends heavily on the size of your data and the consistency level(W and D) you chose.</li>
<li>The lower consistency level you choose, The more frequently you should run <code class="codehilite">recover-node</code>.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="related-links">Related Links<a class="headerlink" href="#related-links" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="../../../architecture/leo_storage/">Concept and Architecture / LeoStorage's Architecture</a></li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../cluster/" title="Cluster Operations" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Cluster Operations
              </span>
            </div>
          </a>
        
        
          <a href="../multi_dc_replication/" title="Multi Data Center Replication" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Multi Data Center Replication
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            (c) 2012-2018 LeoProject. All rights reserved.
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.8eb9be28.js"></script>
      
      <script>app.initialize({version:"0.17.3",url:{base:"../../.."}})</script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-5301881-3","leo-project.net"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>